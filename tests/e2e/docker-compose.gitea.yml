services:
  gitea:
    image: gitea/gitea:1.21
    container_name: gitea
    environment:
      - GITEA__security__INSTALL_LOCK=true
      - GITEA__server__ROOT_URL=http://localhost:${GITEA_TEST_PORT:-3000}
      - GITEA__server__HTTP_PORT=${GITEA_TEST_PORT:-3000}
      - GITEA__database__DB_TYPE=sqlite3
      - GITEA__service__DISABLE_REGISTRATION=false
      - GITEA__service__REQUIRE_SIGNIN_VIEW=false
    ports:
      - "${GITEA_TEST_PORT:-3000}:${GITEA_TEST_PORT:-3000}"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${GITEA_TEST_PORT:-3000}/api/v1/version"]
      interval: 5s
      timeout: 3s
      retries: 10
